# Lecture 4 | Stanford CS193p 2023

- è¯¾ç¨‹é“¾æ¥ï¼šhttps://www.youtube.com/watch?v=4CkEVfdqjLw

- ä»£ç ä»“åº“ï¼š[iOS](https://github.com/manredeshanxiren/iOS)

- è¯¾ç¨‹å¤§çº²ï¼š

  **ç®€è¦è¯¾ç¨‹å¤§çº²ï¼šSwiftUI é«˜çº§ä¸»é¢˜**

  1. **Swift è®¿é—®æ§åˆ¶ï¼ˆAccess Controlï¼‰**
     - 5 ä¸ªçº§åˆ«ï¼š`open`ã€`public`ã€`internal`ã€`fileprivate`ã€`private`
     - `private(set)` ä¸ `fileprivate(set)` çš„ç”¨æ³•
     - åœ¨ SwiftUI è§†å›¾ä¸æ¨¡å—åŒ–ä¸­çš„æœ€ä½³å®è·µ
  2. **è§†å›¾åˆå§‹åŒ–ï¼ˆ`init`ï¼‰ä¸å±æ€§åŒ…è£…å™¨é…åˆ**
     - åˆæˆ `init` ä¸è‡ªå®šä¹‰ `init` æ—¶æœº
     - åœ¨ `init` ä¸­æ­£ç¡®é…ç½®ï¼š
       - `@Binding`ï¼ˆçˆ¶â€“å­åŒå‘ç»‘å®šï¼‰
       - `@ObservedObject`ï¼ˆå¤–éƒ¨ä¼ å…¥æ¨¡å‹ï¼‰
       - `@StateObject`ï¼ˆé¦–æ¬¡åˆ›å»ºæ¨¡å‹ï¼‰
     - `init` ä¸­çš„é™åˆ¶ä¸åº”å°†å‰¯ä½œç”¨å»¶ååˆ° `onAppear`
  3. **å¾ªç¯ä¸éå† (`for-in`)**
     - éå†æ•°ç»„ã€å­—å…¸ã€èŒƒå›´ (`Range`)
     - `enumerated()` è·å–ç´¢å¼•
     - `where` æ¡ä»¶è¿‡æ»¤ã€`break`/`continue`
     - ä¿®æ”¹åŸé›†åˆçš„æŠ€å·§
  4. **å‡½æ•°ç±»å‹ä¸é—­åŒ…ï¼ˆFunctions & Closuresï¼‰**
     - å‡½æ•°å³ç±»å‹ï¼š`() -> Void`ã€`(Int) -> String`ã€`() -> some View`
     - å›è°ƒå‚æ•°ä¸è‡ªå®šä¹‰ `ViewBuilder`
     - é—­åŒ…è¯­æ³•ç®€å†™ï¼šç±»å‹æ¨æ–­ã€`$0`ã€çœç•¥ `return`
     - **æ•è·ï¼ˆCapturingï¼‰**ï¼šé—­åŒ…å¦‚ä½•â€œåŒ…ä½â€å¤–éƒ¨å˜é‡
  5. **å¼‚æ­¥ä¸é€ƒé€¸é—­åŒ… (`@escaping`ã€`async/await`)**
     - ä½•æ—¶ä½¿ç”¨ `@escaping`ï¼šç½‘ç»œè¯·æ±‚ã€GCDã€å®šæ—¶å™¨
     - SwiftUI ä¸­çš„å¼‚æ­¥ï¼š`Task { await â€¦ }`ã€`.task` & æŒ‰é’®å†…éƒ¨
     - ç»“åˆ `@MainActor` å›åˆ°ä¸»çº¿ç¨‹æ›´æ–°çŠ¶æ€
  6. **ç±»å‹çº§æˆå‘˜ï¼š`static` å˜é‡ä¸å‡½æ•°**
     - ä¸å®ä¾‹æ— å…³çš„å¸¸é‡ã€å·¥å…·æ–¹æ³•
     - å…±äº«æ ·å¼ã€æ ¼å¼åŒ–å™¨ã€é¢„è§ˆæä¾›è€… (`PreviewProvider`)
     - `struct`/`enum` å‘½åç©ºé—´æ¨¡å¼
  7. **å€¼ç±»å‹æ–¹æ³•çš„ `mutating`**
     - ä¸ºä»€ä¹ˆå€¼ç±»å‹é»˜è®¤ä¸å¯å˜
     - åœ¨æ¨¡å‹å±‚å°è£…å¯å˜é€»è¾‘ï¼š`mutating func`
     - SwiftUI ä¸­é€šè¿‡ `@State`/`@Binding` æ›¿ä»£ç›´æ¥ä½¿ç”¨
  8. **è¯­ä¹‰åŒ–é‡å‘½åï¼ˆSemantic Renameï¼‰**
     - Xcode Refactor â†’ Rename æ“ä½œ
     - è·¨æ–‡ä»¶ã€è·¨æ¨¡å—å®‰å…¨é‡å‘½åæ¥å£ï¼ç±»å‹
     - ä¿æŒé¡¹ç›®ä»£ç ä¸€è‡´æ€§
  9. **SwiftUI å“åº”å¼ UI ä¸çŠ¶æ€ç®¡ç†**
     - **å•ä¸€çœŸç›¸** ä¸ **å£°æ˜å¼ï¼‹å“åº”å¼** æµç¨‹
       1. çŠ¶æ€æ”¹å˜ï¼ˆ`@State`ã€`@Published`ã€ç¯å¢ƒå€¼ï¼‰
       2. Combine Publisher å‘äº‹ä»¶
       3. SwiftUI æ ‡è®° View å¤±æ•ˆ â†’ é‡ç®— `body` â†’ diff â†’ æ¸²æŸ“
     - å±æ€§åŒ…è£…å™¨è¯¦è§£ï¼š
       - `@State`ï¼šå±€éƒ¨è½»é‡çŠ¶æ€
       - `@Binding`ï¼šçˆ¶â€“å­åŒå‘ç»‘å®š
       - `@StateObject`ï¼šé¦–æ¬¡åˆ›å»ºå¹¶æ‹¥æœ‰çš„æ¨¡å‹
       - `@ObservedObject`ï¼šå¤–éƒ¨ä¼ å…¥å¹¶è®¢é˜…çš„æ¨¡å‹
       - `@EnvironmentObject`ï¼šè·¨å±‚çº§å…±äº«æ¨¡å‹
       - `@Environment`: ç³»ç»Ÿï¼è‡ªå®šä¹‰ç¯å¢ƒå€¼
     - å…¸å‹åœºæ™¯ç¤ºä¾‹ä¸å¯¹æ¯”

  
---
[TOC]



# 1. access control
åœ¨ SwiftUI ä¸­ï¼Œè®¿é—®æ§åˆ¶ï¼ˆAccess Controlï¼‰æ²¿ç”¨äº† Swift è¯­è¨€æœ¬èº«çš„äº”ä¸ªçº§åˆ«ï¼šopenã€publicã€internalï¼ˆé»˜è®¤ï¼‰ã€fileprivateã€privateã€‚åˆç†è¿ç”¨è¿™äº›ä¿®é¥°ç¬¦ï¼Œèƒ½æœ‰æ•ˆéš”ç¦»è§†å›¾æ¥å£ä¸å†…éƒ¨å®ç°ï¼Œå¢å¼ºæ¨¡å—åŒ–ä¸å¯ç»´æŠ¤æ€§ã€‚ä»¥ä¸‹åˆ†å‡ éƒ¨åˆ†è¯¦è¿°å…¶åœ¨ SwiftUI å¼€å‘ä¸­çš„å¸¸è§åº”ç”¨å’Œæ³¨æ„äº‹é¡¹ã€‚
| çº§åˆ«          | æ¨¡å—å¤–å¯è§ | åŒä¸€æ¨¡å—å†…å¯è§ | åŒä¸€æ–‡ä»¶å†…å¯è§ | åŒä¸€ç±»å‹å†…å¯è§ |
| ------------- | :--------: | :------------: | :------------: | :------------: |
| `open`        |     âœ…      |       âœ…        |       âœ…        |       âœ…        |
| `public`      |     âœ…      |       âœ…        |       âœ…        |       âœ…        |
| `internal`    |     âŒ      |       âœ…        |       âœ…        |       âœ…        |
| `fileprivate` |     âŒ      |       âŒ        |       âœ…        |       âœ…        |
| `private`     |     âŒ      |       âŒ        |       âŒ        |       âœ…        |

- open/publicï¼šå¯¼å‡ºçš„ APIï¼Œå¯è¢«å¤–éƒ¨æ¨¡å—å¯¼å…¥ä¸è°ƒç”¨ï¼›åªæœ‰ open å…è®¸è¢«å­ç±»åŒ–ä¸é‡å†™ã€‚
- internalï¼ˆé»˜è®¤ï¼‰ï¼šä»…é™å½“å‰æ¨¡å—ï¼ˆApp æˆ– Frameworkï¼‰å†…éƒ¨å¯è§ã€‚
- fileprivateï¼šä»…é™åŒä¸€æºæ–‡ä»¶å†…å¯è§ã€‚
- privateï¼šä»…é™åŒä¸€å£°æ˜åŸŸï¼ˆç±»å‹æˆ–æ‰©å±•ï¼‰å†…å¯è§ã€‚
---

## 1.1 å åŠ ç”¨æ³•ï¼š

Swift ç›®å‰åªæ”¯æŒå°† setter è®¿é—®æƒé™ ç‹­çª„åŒ–åˆ° fileprivate æˆ– privateï¼Œä¹Ÿå°±æ˜¯åªæœ‰è¿™ä¸¤ç§å†™æ³•ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬å’Œä»»ä½•æ›´å®½æ¾çš„è®¿é—®çº§åˆ«ï¼ˆopenã€publicã€internalã€fileprivateï¼‰é…åˆä½¿ç”¨ï¼Œä½†ä¸èƒ½åè¿‡æ¥æ‰©å¤§ï¼š

```swift
// â€”â€” åˆæ³•ï¼šåªèƒ½æ¯”å£°æ˜çº§åˆ«æ›´â€œç§æœ‰â€ â€”â€”

// 1ï¸âƒ£ å®Œå…¨ç§æœ‰ï¼šåŒç±»å‹ï¼ˆåŒæ‰©å±•/åŒèŠ±æ‹¬å·ï¼‰å†…å¯å†™ï¼Œå…¶å®ƒåœ°æ–¹åªè¯»
private(set) var foo: Int  

// 2ï¸âƒ£ æ–‡ä»¶ç§æœ‰ï¼šåŒæ–‡ä»¶å†…å¯å†™ï¼Œå…¶å®ƒæ–‡ä»¶åªè¯»
fileprivate(set) var bar: Int  

// 3ï¸âƒ£ å…¬å…±åªè¯»ï¼šæ¨¡å—å¤–å¯è¯»ï¼Œæ¨¡å—/æ–‡ä»¶å†…å¯è¯»ï¼Œåªæœ‰ç±»å‹å†…éƒ¨å¯å†™
public private(set) var baz: Int  

// 4ï¸âƒ£ å¼€æ”¾åªè¯»ï¼ˆrareï¼‰ï¼šæ¨¡å—å¤–å¯ç»§æ‰¿/å¯é‡å†™ï¼Œå¤–éƒ¨å¯è¯»ï¼Œåªæœ‰ç±»å‹å†…ç§æœ‰å†™
open private(set) var qux: Int  

// 5ï¸âƒ£ æ¨¡å—å†…åªå†™ï¼šæ˜¾å¼å†™ internal private(set)ï¼Œç­‰åŒé»˜è®¤ internalï¼‹private(set)
internal private(set) var quux: Int  
```
ä¸èƒ½å†™æˆ public(set)ã€internal(set)ã€open(set) ä¹‹ç±»çš„â€”â€”ç¼–è¯‘å™¨åªå…è®¸ä½ ç”¨ fileprivate(set) æˆ– private(set)ã€‚


## 1.2 ç»†èŠ‚ï¼š

1ï¸âƒ£ openå’Œpublicçš„åŒºåˆ«ï¼š

- open = å…¬å…±å¯è®¿é—® + å¤–éƒ¨å¯ç»§æ‰¿/å¯é‡å†™
- public = ä»…å…¬å…±å¯è®¿é—®ï¼Œå¤–éƒ¨ä¸å¯ç»§æ‰¿/ä¸å¯é‡å†™

é€‰æ‹©æ—¶ï¼Œç‰¢è®°â€œæœ€å°æš´éœ²åŸåˆ™â€ï¼šèƒ½ç”¨ public é™åˆ¶å°±åˆ«ç”¨ openï¼Œé¿å…æ— æ„ä¸­å¼€æ”¾è¿‡å¤šæ‰©å±•ç‚¹ã€‚å¦å¤–è¿™é‡Œå¯ä»¥çœ‹åˆ°å·®å¼‚ä¸»è¦åœ¨ç»§æ‰¿æ€§ä¸Šï¼Œæ‰€ä»¥**openåªèƒ½ä¿®é¥°å¯ç»§æ‰¿çš„ç±»å‹**ï¼



2ï¸âƒ£ è§†å›¾ç±»å‹ï¼ˆstruct Viewï¼‰çš„å¯è§æ€§ï¼š

- é»˜è®¤ internalï¼šå¦‚æœä½ ä¸æ ‡æ³¨ï¼ŒSwiftUI è§†å›¾å¯¹åŒä¸€æ¨¡å—å†…éƒ½å¯è§ï¼›é€šå¸¸è¶³å¤Ÿåº”ç”¨å†…éƒ¨æ¨¡å—åŒ–ã€‚


# 2.init
åœ¨ SwiftUI ä¸­ï¼Œæ‰€æœ‰è§†å›¾ï¼ˆViewï¼‰æœ¬è´¨ä¸Šéƒ½æ˜¯å€¼ç±»å‹ï¼ˆstructï¼‰ï¼Œå®ƒä»¬çš„åˆå§‹åŒ–å™¨ï¼ˆinitï¼‰æ‰¿æ‹…ç€ä»¥ä¸‹æ ¸å¿ƒèŒè´£ï¼š

 1. æ¥æ”¶å¤–éƒ¨å‚æ•°å¹¶åˆå§‹åŒ–å­˜å‚¨å±æ€§
 2. é…ç½®å±æ€§åŒ…è£…å™¨ï¼ˆ@Stateã€@Bindingã€@ObservedObjectã€@StateObject ç­‰ï¼‰
 3. å†³å®šè§†å›¾çš„åˆå§‹çŠ¶æ€

ä¸‹é¢ä»å‡ ä¸ªè§’åº¦è¯¦ç»†è¯´æ˜ SwiftUI ä¸­çš„ init ä½¿ç”¨è¦ç‚¹ã€‚

## 2.1  é»˜è®¤åˆæˆçš„ init ä¸ä½•æ—¶éœ€è¦è‡ªå®šä¹‰
- **åˆæˆåˆå§‹åŒ–å™¨:**
å¦‚æœä½ çš„ `struct MyView: View `ä¸­æ‰€æœ‰å­˜å‚¨å±æ€§éƒ½æœ‰é»˜è®¤å€¼ï¼Œä¸”ä½ æ²¡æœ‰æ˜¾å¼å®šä¹‰ä»»ä½•` init`ï¼ŒSwift ä¼šè‡ªåŠ¨åˆæˆä¸€ä¸ªæ— å‚ `init()`ã€‚
- **éœ€è¦è‡ªå®šä¹‰çš„åœºæ™¯:**
è§†å›¾éœ€è¦æ¥å—å‚æ•°ï¼Œä¾‹å¦‚ï¼š
```swift
struct GreetingView: View {
  let name: String
  var body: some View { Text("Hello, \(name)!") }
}
// Swift ä¼šåˆæˆ: init(name: String)
```

## 2.2 ä¸å±æ€§åŒ…è£…å™¨é…åˆ
@Stateã€@Bindingã€@ObservedObjectã€@StateObject

> [!NOTE]
>
> æ³¨æ„ï¼šSwiftUI ä¸­çš„è¿™äº›å±æ€§åŒ…è£…å™¨éƒ½éµä» DynamicPropertyï¼Œinit ä¸­çš„èµ‹å€¼é€šå¸¸è¦ç”¨åº•å±‚å­˜å‚¨å±æ€§ï¼ˆå¸¦ä¸‹åˆ’çº¿çš„å½¢å¼ï¼‰ã€‚

| åŒ…è£…å™¨                                | åˆå§‹åŒ–è¦æ±‚                                                   |
| ------------------------------------- | ------------------------------------------------------------ |
| `@State`                              | å¯ç»™å‡ºåˆå§‹å€¼ï¼š`@State private var count = 0`ï¼Œæ— éœ€åœ¨ `init` ä¸­å¤„ç† |
| `@Binding`                            | å¿…é¡»ç”±çˆ¶è§†å›¾ä¼ å…¥ï¼š`init(isOn: Binding<Bool>) { _isOn = isOn }` |
| `@ObservedObject`                     | é€šå¸¸ç”±å¤–éƒ¨ä¼ å…¥å·²æœ‰çš„ ObservableObjectï¼š`init(viewModel: VM) { _viewModel = ObservedObject(wrappedValue: viewModel) }` |
| `@StateObject`                        | åªåœ¨è§†å›¾ç”Ÿå‘½å‘¨æœŸå†…é¦–æ¬¡åˆ›å»ºï¼š`init() { _vm = StateObject(wrappedValue: VM()) }` æˆ–é€šè¿‡å‚æ•°æ³¨å…¥ |
| `@EnvironmentObject` / `@Environment` | ç”±ç³»ç»Ÿæ³¨å…¥ï¼Œä¸éœ€æ‰‹åŠ¨åˆå§‹åŒ–                                   |

ä¾‹å¦‚ï¼š

```swift
class VM: ObservableObject {
  @Published var name = "World"
}

struct DetailView: View {
  // çˆ¶è§†å›¾æˆ–å¤–éƒ¨æ³¨å…¥
  @ObservedObject private var viewModel: VM
  // æˆ–é¦–æ¬¡åˆ›å»º
  @StateObject private var createdVM: VM

  // custom init å¿…é¡»é…ç½®åŒ…è£…å™¨çš„åº•å±‚å­˜å‚¨
  init(viewModel: VM) {
    // æ³¨æ„å·¦ä¾§ä¸‹åˆ’çº¿ï¼šè®¿é—®åŒ…è£…å™¨çš„åº•å±‚å­˜å‚¨
    _viewModel = ObservedObject(wrappedValue: viewModel)
    _createdVM = StateObject(wrappedValue: VM())
  }

  var body: some View {
    VStack {
      Text("Observed: \(viewModel.name)")
      Text("Created: \(createdVM.name)")
    }
  }
}
```

- **`@Binding` ç¤ºä¾‹**ï¼š

```swift
struct ToggleView: View {
  @Binding private var isOn: Bool

  init(isOn: Binding<Bool>) {
    _isOn = isOn
  }

  var body: some View {
    Toggle("Switch", isOn: $isOn)
  }
}
```

## 2.3`init` ä¸­çš„é™åˆ¶ä¸è¡Œä¸º

1. **`body` å°šä¸å¯ç”¨**
    `init` æ‰§è¡Œæ—¶ `body` å°šæœªæ„å»ºï¼Œä¸è¦åœ¨ `init` é‡Œè§¦å‘è§†å›¾æ¸²æŸ“æˆ–ä¾èµ– `body` å±æ€§ã€‚
2. **ç¦æ­¢åœ¨ `init` ä¸­åšå‰¯ä½œç”¨**
    é¿å…åœ¨ `init` ä¸­æ‰§è¡Œç½‘ç»œè¯·æ±‚ã€å®šæ—¶å™¨å¯åŠ¨ç­‰å‰¯ä½œç”¨ï¼›åº”æŠŠè¿™ç±»é€»è¾‘æ”¾åœ¨ `onAppear` æˆ–è§†å›¾æ¨¡å‹é‡Œã€‚
3. **`@StateObject` é¦–æ¬¡åˆå§‹åŒ–**

- `@StateObject` åªèƒ½åœ¨è§†å›¾çš„ `init` ä¸­èµ‹äºˆåˆå§‹å€¼ä¸€æ¬¡ï¼›åç»­è§†å›¾é‡å»ºæ—¶ï¼ˆå¦‚çˆ¶è§†å›¾åˆ·æ–°ï¼‰ä¸ä¼šé‡æ–°åˆå§‹åŒ–ã€‚

- åˆ‡è®°ä¸è¦åœ¨è§†å›¾çš„å…¶å®ƒç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆå¦‚ `body`ï¼‰ä¸­å†æ¬¡åˆ›å»º `StateObject`ï¼Œä»¥å…ä¸¢å¤±çŠ¶æ€ã€‚

# 3. for in

## 3.1 åŸºæœ¬è¯­æ³•

```swift
for item in collection {
    // æ‰§è¡Œæ“ä½œ
}

//æˆ–è€…æˆ‘ä»¬åœ¨å¾ªç¯ä¸­å¹¶ä¸å…³å¿ƒç´¢å¼•,åªæ˜¯æƒ³å¾ªç¯è‹¥å¹²æ¬¡ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨_æ¥ä»£æ›¿
for _ in 1..<5 {
    // æ‰§è¡Œæ“ä½œ
}
```

------

## 3.1 éå†å¸¸è§ç±»å‹

### 3.1.1 éå†æ•°ç»„

```swift
let fruits = ["Apple", "Banana", "Cherry"]

for fruit in fruits {
    print("I like \(fruit)")
}
```

### 3.1.2 éå†åŒºé—´ï¼ˆèŒƒå›´ï¼‰

```swift
for i in 1...5 {
    print(i)  // è¾“å‡º 1 åˆ° 5ï¼ˆé—­åŒºé—´ï¼‰
}

for i in 1..<5 {
    print(i)  // è¾“å‡º 1 åˆ° 4ï¼ˆåŠå¼€åŒºé—´ï¼‰
}
```

> [!NOTE]
>
> å…³äºèŒƒå›´ï¼š
>
>  Swift ä¸­çš„ `1...n` è¿™ç§å†™æ³•ï¼Œä¹Ÿå«**åŒºé—´è¿ç®—ç¬¦ï¼ˆRange Operatorï¼‰**ï¼Œåœ¨ `for-in` å¾ªç¯ä¸­ç»å¸¸ä½¿ç”¨ã€‚
>
> - `1...n`ï¼šé—­åŒºé—´è¿ç®—ç¬¦ï¼ˆClosed Rangeï¼‰,è¡¨ç¤º[1, n]
> - `1..<n`ï¼šåŠå¼€åŒºé—´è¿ç®—ç¬¦ï¼ˆHalf-Open Rangeï¼‰,è¡¨ç¤º[1, n)
> - é€†åºéå†: `(1...5).reversed()`

### 3.1.3 éå†å­—å…¸

```swift
let scores = ["Alice": 90, "Bob": 85]

//æœ‰ç‚¹ç±»ä¼¼äºC++17ä¸­çš„ç»“æ„åŒ–ç»‘å®šçš„å†™æ³•ï¼Œåªä¸è¿‡C++ç”¨çš„æ˜¯[]
for (name, score) in scores {
    print("\(name): \(score)")
}
```

### 3.1.4 éå†å¹¶è·å–ç´¢å¼•ï¼ˆ`enumerated()`ï¼‰

```swift
let names = ["Tom", "Jerry", "Spike"]

for (index, name) in names.enumerated() {
    print("\(index): \(name)")
}
```

------

## 3.2 æ§åˆ¶è¯­å¥æ­é…

### 3.2.1 ä½¿ç”¨ `where` æ·»åŠ æ¡ä»¶

```swift
for i in 1...10 where i % 2 == 0 {
    print(i)  // è¾“å‡ºå¶æ•°
}
```

### 3.2.2 ä½¿ç”¨ `break` å’Œ `continue`

```swift
for i in 1...5 {
    if i == 3 { continue }  // è·³è¿‡3
    if i == 5 { break }     // æå‰ç»ˆæ­¢
    print(i)
}
```

------

### 3.2.3 æ³¨æ„äº‹é¡¹

- å¾ªç¯å˜é‡é»˜è®¤ä¸ºå¸¸é‡ï¼ˆ`let`ï¼‰ï¼Œä¸å¯ä¿®æ”¹ï¼š

  ```swift
  for n in numbers {
      n += 1  // âŒ ç¼–è¯‘é”™è¯¯
  }
  ```

- å¦‚éœ€ä¿®æ”¹åŸæ•°ç»„ï¼Œå»ºè®®ä½¿ç”¨ä¸‹æ ‡è®¿é—®ï¼š

  ```swift
  for i in 0..<array.count {
      array[i] += 1
  }
  ```

------

### 3.2.4 å°ç»“è¡¨æ ¼

| ç±»å‹     | ç¤ºä¾‹                               | è¯´æ˜             |
| -------- | ---------------------------------- | ---------------- |
| æ•°ç»„     | `for x in arr`                     | éå†å…ƒç´          |
| åŒºé—´     | `for i in 1...n`                   | é—­/å¼€åŒºé—´        |
| å­—å…¸     | `for (k, v) in dict`               | éå†é”®å€¼å¯¹       |
| ç´¢å¼•+å€¼  | `for (i, v) in arr.enumerated()`   | åŒæ—¶è·å–ç´¢å¼•å’Œå€¼ |
| æ¡ä»¶éå† | `for i in 1...10 where i % 2 == 0` | æ·»åŠ ç­›é€‰æ¡ä»¶     |

# 4. functions as types

åœ¨ SwiftUI ä¸­ï¼Œ**â€œfunctions as typesâ€** æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå°¤å…¶æ˜¯åœ¨å†™ `ViewBuilder`ã€äº‹ä»¶å›è°ƒï¼ˆä¾‹å¦‚ `.onTapGesture`ï¼‰æˆ–è‡ªå®šä¹‰ç»„ä»¶æ—¶ã€‚å®ƒä½“ç°çš„æ˜¯ Swift çš„**ä¸€ç­‰å‡½æ•°ï¼ˆfirst-class functionsï¼‰**ç‰¹æ€§ â€”â€” ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°æœ¬èº«å°±æ˜¯ä¸€ç§ç±»å‹ï¼Œå¯ä»¥ä½œä¸ºå€¼ä¼ é€’ã€èµ‹å€¼ã€è¿”å›æˆ–å­˜å‚¨ã€‚

ğŸ§  ä¸€å¥è¯ç†è§£

> åœ¨ SwiftUI ä¸­ï¼Œå‡½æ•°ä¸ä»…èƒ½â€œè¢«è°ƒç”¨â€ï¼Œè¿˜èƒ½â€œè¢«ä¼ é€’â€æˆ–â€œå­˜å‚¨â€ä¸ºç±»å‹ä½¿ç”¨ã€‚

## 4.1 å‡½æ•°ä½œä¸ºç±»å‹çš„å‡ ç§åœºæ™¯

### 4.1.1 **å›è°ƒå‡½æ•°ä¼ å‚**

```swift
struct MyButton: View {
    let action: () -> Void  // å‡½æ•°ä½œä¸ºç±»å‹ï¼ˆæ— å‚æ•°ã€æ— è¿”å›ï¼‰

    var body: some View {
        Button("Tap Me", action: action)
    }
}

// ä½¿ç”¨æ–¹å¼
MyButton {
    print("Button tapped!")
}
```

- `() -> Void` æ˜¯ä¸€ä¸ª**å‡½æ•°ç±»å‹**ï¼Œè¡¨ç¤ºæ— å‚æ— è¿”å›å€¼ã€‚
- å¯ä»¥æŠŠå‡½æ•°å½“ä½œå˜é‡ä¸€æ ·ä¼ è¿›è§†å›¾ä¸­ã€‚

------

### 4.1.2 **ä½œä¸º ViewBuilder çš„å‡½æ•°å‚æ•°**

```swift
struct CardView<Content: View>: View {
    let content: () -> Content  // å‡½æ•°ç±»å‹ï¼šè¿”å›ä¸€ä¸ª View

    var body: some View {
        VStack {
            Text("Title")
            content()  // è°ƒç”¨å‡½æ•°ï¼Œæ’å…¥å­è§†å›¾
        }
    }
}

// ä½¿ç”¨
CardView {
    Text("Hello")
}
```

è¿™å°±æ˜¯ SwiftUI çš„å£°æ˜å¼ UIï¼š**å­è§†å›¾å°±æ˜¯ä¸€ä¸ªå‡½æ•°è¿”å›çš„ View ç±»å‹ï¼**

------

### 4.1.3 **äº‹ä»¶å¤„ç†ï¼ˆonTapã€gestureï¼‰**

```swift
Text("Tap me")
    .onTapGesture(perform: {
        print("Tapped")
    })
```

- è¿™é‡Œçš„ `perform:` å‚æ•°æ˜¯ä¸€ä¸ª `() -> Void` å‡½æ•°ã€‚
- ä½ å¯ä»¥ä¼ åŒ¿åå‡½æ•°ï¼ˆé—­åŒ…ï¼‰ï¼Œä¹Ÿå¯ä»¥ä¼ å·²æœ‰å‡½æ•°åã€‚

------

## 4.1.4 å‡½æ•°ç±»å‹çš„å½¢å¼

| å‡½æ•°ç­¾å               | æ„ä¹‰                   |
| ---------------------- | ---------------------- |
| `() -> Void`           | æ— å‚æ— è¿”å›             |
| `(Int) -> String`      | ä¼ å…¥ Intï¼Œè¿”å› String  |
| `() -> some View`      | è¿”å›ä¸€ä¸ª SwiftUI è§†å›¾  |
| `@escaping () -> Void` | å‡½æ•°é€ƒé€¸ï¼Œç”¨äºå¼‚æ­¥å›è°ƒ |

------

## 4.1.5 SwiftUI ä¸­ View æœ¬è´¨ä¸Šä¹Ÿæ˜¯å‡½æ•°è°ƒç”¨é“¾

SwiftUI ä¸­å†™ï¼š

```swift
Text("Hi")
    .foregroundColor(.red)
```

æœ¬è´¨æ˜¯å‡½æ•°ç»„åˆï¼š

```swift
func foregroundColor(_ color: Color) -> some View
```

æ‰€ä»¥æ•´ä¸ª `.modifier(...)` ç­‰é“¾å¼è°ƒç”¨ï¼Œéƒ½ä¾èµ–äºâ€œå‡½æ•°ä½œä¸ºç±»å‹â€è¿™ä¸€åº•å±‚æ”¯æŒã€‚

------

## 4.1.6 æ€»ç»“è¦ç‚¹

- Swift ä¸­å‡½æ•°æ˜¯**ä¸€ç­‰ç±»å‹**ï¼Œå¯ä»¥åƒå˜é‡ä¸€æ ·ä½¿ç”¨ã€‚
- SwiftUI ä¸­å¤§é‡ç”¨åˆ° `() -> View` ç±»å‹æ„å»ºè§†å›¾æ ‘ã€‚
- äº‹ä»¶ã€å›è°ƒã€å£°æ˜å¼ç»„ä»¶ä¼ é€’éƒ½ä¾èµ–äºâ€œå‡½æ•°ç±»å‹â€ã€‚
- æ³›å‹å’Œ `@ViewBuilder` å¸¸ç”¨äºçº¦æŸè¿™ç±»å‡½æ•°ã€‚

# 5.é—­åŒ…

## 5.1 ä»€ä¹ˆæ˜¯é—­åŒ…ï¼ˆClosureï¼‰ï¼Ÿ

âœ… é€šä¿—è§£é‡Šï¼š

> é—­åŒ…å°±æ˜¯â€œä¸€æ®µå¯ä»¥è¢«å½“ä½œå˜é‡ä½¿ç”¨çš„å‡½æ•°ä»£ç â€ã€‚

ä½ å¯ä»¥åƒâ€œå€¼â€ä¸€æ ·ï¼ŒæŠŠå®ƒä¼ ç»™åˆ«äººã€å­˜èµ·æ¥ï¼Œæˆ–è€…ä½œä¸ºå‚æ•°ä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°ä¸­ã€‚

---

ğŸ§© ä¸ºä»€ä¹ˆå«â€œé—­åŒ…â€ï¼Ÿ

é—­åŒ…è¿™ä¸ªåå­—æ¥è‡ªäºå®ƒ**â€œæ•è·â€å¹¶â€œè®°ä½â€å…¶ä½œç”¨åŸŸå†…çš„å˜é‡** â€”â€” å°±åƒä¸€ä¸ªå‡½æ•°â€œåŒ…ä½â€äº†å®ƒå®šä¹‰æ—¶çš„ä¸Šä¸‹æ–‡ã€‚

------

## 5.2 é—­åŒ…çš„åŸºæœ¬è¯­æ³•

```swift
let greet = {
    print("Hello")
}

greet()  // è°ƒç”¨é—­åŒ…ï¼Œè¾“å‡ºï¼šHello
```

- `{ ... }` æ˜¯é—­åŒ…ä½“ï¼Œå’Œå‡½æ•°ä½“å¾ˆåƒã€‚
- `greet` æ˜¯é—­åŒ…å˜é‡ï¼Œç±»å‹æ˜¯ `() -> Void`ï¼Œè¡¨ç¤ºâ€œæ— å‚æ— è¿”å›å€¼çš„å‡½æ•°â€ã€‚

------

### 5.2.1 å¸¦å‚æ•°çš„é—­åŒ…

```swift
let square = { (x: Int) -> Int in
    return x * x
}

let result = square(5)  // è¾“å‡º 25
```

- `(x: Int) -> Int` æ˜¯é—­åŒ…ç±»å‹ã€‚
- `in` æŠŠå‚æ•°å’Œé—­åŒ…ä½“åˆ†å¼€ã€‚

------

### 5.2.2 é—­åŒ… vs å‡½æ•°

| é¡¹ç›®       | é—­åŒ…                        | å‡½æ•°                         |
| ---------- | --------------------------- | ---------------------------- |
| è¯­æ³•       | `{ (param) -> Ret in ... }` | `func name(param) -> Ret {}` |
| ç”¨é€”       | ä¼ å€¼ã€å›è°ƒã€æ„å»ºè§†å›¾ç­‰      | å®šä¹‰å…·ä½“é€»è¾‘å•å…ƒ             |
| æ˜¯å¦æœ‰åå­— | ä¸€èˆ¬æ²¡æœ‰ï¼ˆä¹Ÿå¯ä»¥æœ‰ï¼‰        | ä¸€å®šæœ‰åå­—                   |

------

## 5.3 é—­åŒ…çš„å¸¸è§åº”ç”¨ï¼ˆSwiftUI åˆå­¦è€…å¸¸è§åœºæ™¯ï¼‰

### 5.3.1 **äº‹ä»¶å›è°ƒ**

```swift
Button("Tap me") {
    print("Button clicked!")  // è¿™ä¸ªå°±æ˜¯é—­åŒ…
}
```

### 5.3.2 **ä¼ å…¥å‡½æ•°ä¸­**

```swift
func performTwice(action: () -> Void) {
    action()
    action()
}

performTwice {
    print("Doing it twice")
}
```

### 5.3.3 **æ„å»º UI è§†å›¾ï¼ˆ@ViewBuilderï¼‰**

```swift
VStack {
    Text("Line 1")
    Text("Line 2")
}
```

å…¶å® `VStack {}` æ‹¬å·ä¸­çš„å†…å®¹å°±æ˜¯ä¸€ä¸ªè¿”å› `View` çš„é—­åŒ…ã€‚

---

âœ… å°ç»“

- é—­åŒ… = å¯ä»¥å½“ä½œå˜é‡ä¼ æ¥ä¼ å»çš„â€œå‡½æ•°ä»£ç å—â€
- è¯­æ³•ï¼š`{ (å‚æ•°) -> è¿”å›ç±»å‹ in ä»£ç  }`
- SwiftUI åˆ°å¤„éƒ½åœ¨ç”¨é—­åŒ…ï¼Œæ¯”å¦‚æ„å»º UIã€å¤„ç†æŒ‰é’®ç‚¹å‡»ã€å“åº”å˜åŒ–ç­‰ç­‰

## 5.4 Swift é—­åŒ…çš„ç®€å†™è¯­æ³•

Swift æä¾›äº†éå¸¸å¼ºå¤§çš„**é—­åŒ…è¯­æ³•ç®€åŒ–èƒ½åŠ›**ï¼Œå¸¸è§äº SwiftUIã€æ’åºã€è¿‡æ»¤ç­‰åœºæ™¯ã€‚

âœ… ç®€å†™ 1ï¼šçœç•¥è¿”å›ç±»å‹ï¼ˆç±»å‹å¯æ¨æ–­ï¼‰

```swift
let double: (Int) -> Int = { x in
    return x * 2
}
```

âœ… ç®€å†™ 2ï¼šçœç•¥å‚æ•°åï¼Œç”¨ `$0`ã€`$1` ç­‰è¡¨ç¤º

```swift
let double: (Int) -> Int = { $0 * 2 }

let sum: (Int, Int) -> Int = { $0 + $1 }

print(double(3))  // è¾“å‡º 6
print(sum(3, 4))  // è¾“å‡º 7
```

> [!NOTE]
>
> è¿™é‡Œçœ‹åˆ°`return`ä¹Ÿè¢«çœç•¥äº†ï¼ŒåŸå› æ˜¯é—­åŒ…**åªæœ‰ä¸€ä¸ªè¡¨è¾¾å¼**ï¼ŒSwift ç¼–è¯‘å™¨å°±è‡ªåŠ¨å°†é‚£ä¸ªè¡¨è¾¾å¼ä½œä¸ºè¿”å›å€¼ã€‚

---

ğŸ§ª åº”ç”¨ä¾‹å­ï¼šæ•°ç»„ map / filter

```swift
let numbers = [1, 2, 3]

// ç”¨é—­åŒ…æŠŠæ¯ä¸ªæ•° *2
let doubled = numbers.map { $0 * 2 }
print(doubled) // [2, 4, 6]

// è¿‡æ»¤å‡ºå¤§äº1çš„æ•°
let filtered = numbers.filter { $0 > 1 }
print(filtered) // [2, 3]
```

- `map {}` å’Œ `filter {}` éƒ½æ¥å—é—­åŒ…ä½œä¸ºå‚æ•°ã€‚
- `$0` æ˜¯å½“å‰éå†çš„å…ƒç´ ã€‚

---

âœ… å°ç»“ï¼šé—­åŒ…ç®€å†™è¯­æ³•é¡ºåº

| æ­¥éª¤           | ç¤ºä¾‹                         | è¯´æ˜                     |
| -------------- | ---------------------------- | ------------------------ |
| å®Œæ•´å†™æ³•       | `{ (x: Int) -> Int in ... }` | æ˜ç¡®å‚æ•°å’Œè¿”å›ç±»å‹       |
| æ¨æ–­ç±»å‹       | `{ x in ... }`               | å‚æ•°ç±»å‹è¢«ç±»å‹ç³»ç»Ÿæ¨æ–­   |
| ä½¿ç”¨ç®€å†™å‚æ•°å | `{ $0 + 1 }`                 | ç”¨ `$0` è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°   |
| å•è¡¨è¾¾å¼       | `{ $0 + 1 }` æ— éœ€ `return`   | Swift è‡ªåŠ¨è¿”å›è¡¨è¾¾å¼ç»“æœ |

## 5.5 é—­åŒ…æ˜¯å¦‚ä½•â€œæ•è·å€¼â€çš„ï¼Ÿ

âœ… ä¸€å¥è¯ç†è§£ï¼š

> Swift çš„é—­åŒ…å¯ä»¥â€œè®°ä½â€å®ƒ**åˆ›å»ºæ—¶ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å€¼**ï¼Œå³ä½¿è¿™äº›å˜é‡çš„ä½œç”¨åŸŸå·²ç»æ¶ˆå¤±ã€‚

è¿™å°±æ˜¯é—­åŒ…åå­—çš„ç”±æ¥ï¼š**<u>â€œé—­â€ä½äº†ä¸Šä¸‹æ–‡ï¼Œâ€œåŒ…â€ä½äº†å˜é‡ã€‚</u>**

ğŸ§ª **ç¤ºä¾‹ä¸€ï¼šæœ€ç»å…¸çš„æ•è·è¡Œä¸º**

```swift
func makeCounter() -> () -> Int {
    var count = 0

    let counter = {
        count += 1
        return count
    }

    return counter
}

let c = makeCounter()

print(c())  // 1
print(c())  // 2
print(c())  // 3
```

> [!NOTE]
>
> - `count` æ˜¯ `makeCounter` å‡½æ•°é‡Œçš„å±€éƒ¨å˜é‡ã€‚
> - é—­åŒ… `{ count += 1 }` æŠŠå®ƒâ€œæ•è·â€äº†ï¼Œ**å³ä½¿å‡½æ•°æ—©å°±è¿”å›äº†ï¼Œcount ä¾ç„¶å­˜åœ¨å¹¶å¯è®¿é—®**ã€‚
> - æ¯æ¬¡è°ƒç”¨ `c()` éƒ½åœ¨ä¿®æ”¹å®ƒâ€œç§æœ‰â€çš„é‚£ä»½ `count`ã€‚
>
> è¿™å°±å«é—­åŒ…æ•è·ï¼ˆClosure Capturingï¼‰ã€‚

---

ğŸ§ª ç¤ºä¾‹äºŒï¼šå¤šä¸ªé—­åŒ…å…±äº«åŒä¸€ä¸ªä¸Šä¸‹æ–‡å˜é‡

```swift
func makeTwoCounters() -> (() -> Int, () -> Int) {
    var count = 0

    let increment = { () -> Int in
        count += 1
        return count
    }

    let report = { () -> Int in
        return count
    }

    return (increment, report)
}

let (inc, read) = makeTwoCounters()
print(inc())  // 1
print(inc())  // 2
print(read()) // 2 ï¼ˆå…±äº«å˜é‡ï¼‰
```

ä¸¤ä¸ªé—­åŒ… **æ•è·äº†åŒä¸€ä¸ªå˜é‡**ï¼Œå®ƒä»¬å…±äº«çŠ¶æ€ï¼

---

âœ… é—­åŒ…æ•è·å˜é‡çš„ç‰¹ç‚¹

| ç‰¹æ€§           | è¯´æ˜                                           |
| -------------- | ---------------------------------------------- |
| æŒä¹…æ€§         | è¢«æ•è·çš„å˜é‡ä¸ä¼šå› ä¸ºå‡½æ•°è¿”å›è€Œé”€æ¯             |
| å¼•ç”¨è¯­ä¹‰       | é—­åŒ…å¯¹å˜é‡æ˜¯â€œå¼•ç”¨â€è€Œä¸æ˜¯â€œæ‹·è´â€ï¼ˆé™¤éæ˜¾å¼å¤„ç†ï¼‰ |
| å¤šé—­åŒ…å…±äº«å˜é‡ | å¤šä¸ªé—­åŒ…å¯å…±äº«åŒä¸€æ•è·çš„å˜é‡                   |

---

ğŸ“Œ Swift ä¸­å¸¸è§çš„é—­åŒ…æ•è·ç”¨æ³•

1. **è®¡æ•°å™¨ï¼ˆå¦‚ä¸Šä¾‹ï¼‰**
2. **å¼‚æ­¥å›è°ƒï¼ˆéœ€è¦æ•è·æŸäº›çŠ¶æ€ï¼‰**
3. **SwiftUI çš„åŠ¨ç”»æˆ–å“åº”äº‹ä»¶å›è°ƒ**
4. **GCDã€Timerã€URLSession ä¸­ä½¿ç”¨ self æ—¶æ³¨æ„æ•è·æ–¹å¼**

---

âœ… å°ç»“

- é—­åŒ…â€œåŒ…ä½â€å®ƒåˆ›å»ºæ—¶çš„å˜é‡ç¯å¢ƒï¼Œå‡½æ•°ä½œç”¨åŸŸç»“æŸåä¹Ÿèƒ½ç»§ç»­è®¿é—®ã€‚
- è¿™æ˜¯é—­åŒ…æœ€å¤§çš„ç‰¹æ€§ä¹‹ä¸€ã€‚
- è¢«æ•è·çš„å˜é‡å…¶å®æ˜¯â€œå¼•ç”¨æ•è·â€ï¼Œä¼šè¢«é—­åŒ…æŒæœ‰ã€‚

------

## 5.6 é—­åŒ… + çŠ¶æ€ï¼ˆ@State / @Bindingï¼‰çš„å¸¸è§æ¨¡å¼

SwiftUI ä¸­çš„è§†å›¾æ˜¯â€œå£°æ˜å¼çš„ + å“åº”å¼çš„â€ï¼Œ**çŠ¶æ€æ”¹å˜ä¼šè‡ªåŠ¨è§¦å‘ UI æ›´æ–°**ã€‚è€Œé—­åŒ…ï¼Œæ­£æ˜¯è´Ÿè´£**é©±åŠ¨çŠ¶æ€æ”¹å˜ã€å¤„ç†ç”¨æˆ·æ“ä½œ**çš„å…³é”®ã€‚

---

ğŸ¯ ç›®æ ‡ä¾‹å­ï¼šè®¡æ•°å™¨æŒ‰é’®

```swift
struct CounterView: View {
    @State private var count = 0

    var body: some View {
        VStack {
            Text("Count: \(count)")
                .font(.largeTitle)

            Button("Tap Me") {
                // è¿™ä¸ªé—­åŒ…è¢«è§¦å‘åï¼Œcount çŠ¶æ€ä¼šæ›´æ–°ï¼ŒUI è‡ªåŠ¨åˆ·æ–°
                count += 1
            }
        }
    }
}
```

> [!NOTE]
>
> âœ… åˆ†æï¼š
>
> - `@State` æ˜¯ä¸€ä¸ª**æºçŠ¶æ€**ï¼Œ`count` æ˜¯ UI çš„æ•°æ®æ¥æºã€‚
> - `Button {}` ä¸­çš„é—­åŒ…è´Ÿè´£**æ›´æ”¹çŠ¶æ€**ã€‚
> - SwiftUI è‡ªåŠ¨è¿½è¸ªè¿™ä¸ªçŠ¶æ€ï¼Œ**çŠ¶æ€å˜ â†’ UI è‡ªåŠ¨å˜**ã€‚

---

ğŸ” **æ¨¡å¼ 1ï¼šé—­åŒ…å“åº”çŠ¶æ€æ›´æ–°**

ğŸ§ª ç¤ºä¾‹ï¼šåˆ‡æ¢å¼€å…³

```swift
@State private var isOn = false

Toggle("Enable feature", isOn: $isOn)
//$isOn æ˜¯ç»‘å®šï¼ˆBinding<Bool>ï¼‰ï¼Œå®ƒæŠŠå¯¹ isOn çš„è¯»å†™æ“ä½œå°è£…èµ·æ¥ï¼Œä¼ ç»™ Toggle æ§ä»¶ã€‚
//å½“å¼€å…³åˆ‡æ¢æ—¶ï¼ŒToggle ä¼šé€šè¿‡è¿™ä¸ª Binding è‡ªåŠ¨æ›´æ–° isOnã€‚
//å½“ isOn å˜åŒ–æ—¶ï¼Œç•Œé¢ä¹Ÿä¼šè‡ªåŠ¨åˆ·æ–°ã€‚
```

- è¿™ä¸ª `Toggle` ä¼šè‡ªåŠ¨ç»‘å®š `isOn` çŠ¶æ€ã€‚
- ä½ ä¹Ÿå¯ä»¥åŠ å…¥é—­åŒ…å“åº”çŠ¶æ€å˜åŒ–ï¼š

```swift
Toggle("Enable", isOn: $isOn)
    .onChange(of: isOn) { newValue in
        print("Switch changed: \(newValue)")
    }
```

- `onChange` æ¥æ”¶ä¸€ä¸ªé—­åŒ… `(T) -> Void`ï¼Œåœ¨çŠ¶æ€å˜æ›´æ—¶è°ƒç”¨ã€‚

---

ğŸ”„ **æ¨¡å¼ 2ï¼šçˆ¶å­ç»„ä»¶é€šä¿¡ç”¨é—­åŒ… + @Binding**

âœ… ç›®æ ‡ï¼šç‚¹å‡»å­è§†å›¾æŒ‰é’®ï¼Œè®©çˆ¶è§†å›¾çš„è®¡æ•°å™¨å¢åŠ 

ğŸ”§ å­è§†å›¾ï¼š

```swift
struct ChildView: View {
    let onTap: () -> Void  // é—­åŒ…ä½œä¸ºå‚æ•°

    var body: some View {
        Button("Child Tap", action: onTap)
    }
}
```

ğŸ§© çˆ¶è§†å›¾ï¼š

```swift
struct ParentView: View {
    @State private var count = 0

    var body: some View {
        VStack {
            Text("Count: \(count)")
            ChildView {
                count += 1  // é—­åŒ…æ•è·çˆ¶è§†å›¾çŠ¶æ€
            }
        }
    }
}
```

ğŸ§  æ€»ç»“ï¼š

- å­è§†å›¾é€šè¿‡é—­åŒ… `onTap` é€šçŸ¥çˆ¶è§†å›¾ã€‚
- çˆ¶è§†å›¾é€šè¿‡ `@State` æŒæœ‰çŠ¶æ€å¹¶åœ¨é—­åŒ…ä¸­ä¿®æ”¹å®ƒã€‚
- è¿™æ˜¯ SwiftUI **å•å‘æ•°æ®æµ + é—­åŒ…å›è°ƒæœºåˆ¶**çš„ä½“ç°ã€‚

---

ğŸ“¦ æ¨¡å¼ 3ï¼š@Binding + é—­åŒ…åšè¡¨å•äº¤äº’ç»„ä»¶

```swift
struct LabeledToggle: View {
    @Binding var isOn: Bool  // ç”±çˆ¶è§†å›¾æä¾›çŠ¶æ€

    var body: some View {
        Toggle("Enabled", isOn: $isOn)
    }
}
```

åœ¨çˆ¶è§†å›¾ä¸­è¿™æ ·ä½¿ç”¨ï¼š

```swift
@State private var active = false

LabeledToggle(isOn: $active)
```

- è¿™é‡Œæ²¡æœ‰æ˜¾å¼é—­åŒ…ï¼Œä½†å…¶å®**`$isOn` å°±æ˜¯ä¸€ä¸ªåŒå‘ç»‘å®šçš„â€œçŠ¶æ€é©±åŠ¨å‹é—­åŒ…â€**ã€‚
- ä½ å¯ä»¥æƒ³è±¡å®ƒåƒè¿™æ ·å·¥ä½œï¼š

```swift
Toggle("...", isOn: Binding(
    get: { active },
    set: { active = $0 }
))
```

---

âœ… å°ç»“ï¼šé—­åŒ… + çŠ¶æ€æ¨¡å¼å¯¹ç…§è¡¨

| åœºæ™¯             | ä½¿ç”¨æ–¹å¼                       | æœ¬è´¨                |
| ---------------- | ------------------------------ | ------------------- |
| ç‚¹å‡»æŒ‰é’®æ›´æ–°çŠ¶æ€ | `Button { count += 1 }`        | é—­åŒ…æ•è· @State     |
| çŠ¶æ€å˜æ›´å“åº”     | `.onChange(of: var) { ... }`   | é—­åŒ…ç›‘å¬çŠ¶æ€        |
| å­ä¼ çˆ¶å›è°ƒ       | `ChildView(onTap: { ... })`    | é—­åŒ…å›è°ƒ + çŠ¶æ€é©±åŠ¨ |
| ç»„ä»¶ç»‘å®š         | `@Binding var isOn` + `$value` | åŒå‘çŠ¶æ€é©±åŠ¨        |

------

å¥½çš„ï¼Œæˆ‘ä»¬ç»§ç»­è¿›å…¥ SwiftUI ä¸­é—­åŒ…å­¦ä¹ çš„ç¬¬ 5 éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†å°†å¼•å…¥ä¸€ä¸ªéå¸¸é‡è¦ä½†å¸¸è¢«å¿½ç•¥çš„å®è·µä¸»é¢˜ï¼š

------

## 5.7`@escaping` å’Œå¼‚æ­¥é—­åŒ…åœ¨ SwiftUI ä¸­çš„è§’è‰²

âœ… ä¸€å¥è¯ç†è§£

> åœ¨ SwiftUI ä¸­ï¼Œæ‰€æœ‰**å»¶è¿Ÿæ‰§è¡Œã€å¼‚æ­¥è§¦å‘æˆ–æŒä¹…ä¿å­˜çš„é—­åŒ…**éƒ½å¿…é¡»æ ‡æ³¨ä¸º `@escaping`ï¼Œè¿™æ˜¯ç¡®ä¿é—­åŒ…åœ¨ä½œç”¨åŸŸå¤–ä»ç„¶æœ‰æ•ˆçš„å…³é”®ã€‚

è€Œ SwiftUI + async/await çš„ç»“åˆï¼Œä¹Ÿéœ€è¦é—­åŒ…æ”¯æŒå¼‚æ­¥ç»“æ„ã€‚

---

ğŸ” å›é¡¾ï¼šä»€ä¹ˆæ˜¯ `@escaping`

åœ¨ Swift ä¸­ï¼Œé»˜è®¤é—­åŒ…æ˜¯ **éé€ƒé€¸ï¼ˆnon-escapingï¼‰** â€”â€” ä¹Ÿå°±æ˜¯è¯´å¿…é¡»åœ¨å‡½æ•°ä½“å†…è¢«è°ƒç”¨å®Œã€‚

**è€Œ `@escaping` è¡¨ç¤ºï¼šè¿™ä¸ªé—­åŒ…å¯èƒ½åœ¨å‡½æ•°è¿”å›ä¹‹åæ‰ä¼šè¢«è°ƒç”¨ã€‚**

---

åœºæ™¯ 1ï¼šå¼‚æ­¥è¯·æ±‚ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰

```swift
func loadData(completion: @escaping (String) -> Void) {
    DispatchQueue.global().async {
        // æ¨¡æ‹Ÿå¼‚æ­¥ä»»åŠ¡
        sleep(1)
        DispatchQueue.main.async {
            completion("Loaded result")
        }
    }
}
```

è°ƒç”¨ï¼š

```swift
loadData { result in
    print("Result is \(result)")
}
```

- é—­åŒ…ä½œä¸ºå›è°ƒå‡½æ•°ï¼Œè¦ç­‰å¼‚æ­¥æ“ä½œå®Œæˆåå†è°ƒç”¨ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯ `@escaping`ã€‚

---

**åœºæ™¯ 2ï¼šSwiftUI ä¸­å¼‚æ­¥ä»»åŠ¡é…åˆé—­åŒ…æ›´æ–°çŠ¶æ€**

```swift
struct AsyncExample: View {
    @State private var message = "Loading..."

    var body: some View {
        VStack {
            Text(message)
            Button("Load") {
                loadData { result in
                    message = result
                }
            }
        }
    }
}
```

> [!NOTE]
>
> - `loadData` æ˜¯ä¸€ä¸ªæ¥å— `@escaping` é—­åŒ…çš„å¼‚æ­¥å‡½æ•°ã€‚
> - SwiftUI ä¸­çš„ `@State` è¢«é—­åŒ…æ•è·åï¼Œæ›´æ–°çŠ¶æ€ä¼šè‡ªåŠ¨åˆ·æ–° UIã€‚

---

âœ… è¿›é˜¶ï¼šSwiftUI + async/await

ä» Swift 5.5 å¼€å§‹ï¼Œä½ å¯ä»¥ç”¨ `async` å’Œ `await` å†™æ›´æ¸…æ™°çš„å¼‚æ­¥é€»è¾‘ï¼Œé…åˆ SwiftUI çš„ `.task` æˆ– `Button`ï¼š

ğŸ”§ ç¤ºä¾‹ï¼š

```swift
struct AsyncAwaitExample: View {
    @State private var message = "Loading..."

    var body: some View {
        VStack {
            Text(message)

            Button("Fetch") {
                Task {
                    message = await fetchData()
                }
            }
        }
    }

    func fetchData() async -> String {
        try? await Task.sleep(nanoseconds: 1_000_000_000)
        return "Async result"
    }
}
```

> [!NOTE]
>
> - `Task {}` æ˜¯ä¸€ä¸ªè‡ªåŠ¨é€ƒé€¸çš„å¼‚æ­¥ç¯å¢ƒï¼ˆç›¸å½“äº GCDï¼‰ã€‚
> - é—­åŒ…å†…éƒ¨å¯ä»¥å†™ `await`ã€‚
> - ä½ æ— éœ€æ˜¾å¼å†™ `@escaping`ï¼Œå› ä¸º `Task` æœ¬èº«æŒæœ‰é—­åŒ…ã€‚

---

âœ… é—­åŒ… + @escaping + @MainActor å¸¸è§ç»„åˆ

```swift
func asyncWork(completion: @escaping (String) -> Void) {
    Task {
        let result = await fetchData()
        await MainActor.run {
            completion(result)
        }
    }
}
```

- åœ¨åå°æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡
- å›åˆ°ä¸»çº¿ç¨‹é€šè¿‡ `@MainActor` è°ƒç”¨é—­åŒ…æ›´æ–° UI

---

âœ… å°ç»“

| åœºæ™¯              | æ˜¯å¦éœ€è¦ `@escaping` | ç¤ºä¾‹                               |
| ----------------- | -------------------- | ---------------------------------- |
| å¼‚æ­¥è¯·æ±‚å›è°ƒ      | âœ… æ˜¯                 | `completion: @escaping () -> Void` |
| SwiftUI çš„ Button | âŒ å¦ï¼ˆç«‹å³è°ƒç”¨ï¼‰     | `Button {}`                        |
| Task å†…å¼‚æ­¥é—­åŒ…   | âœ… è‡ªåŠ¨é€ƒé€¸           | `Task { await ... }`               |
| ç½‘ç»œæˆ–åå°ä»»åŠ¡    | âœ… æ˜¯                 | `URLSession`, `DispatchQueue` ç­‰   |

> [!NOTE]
>
> - åœ¨ SwiftUI ä¸­ï¼Œå¤§å¤šæ•°é—­åŒ…æ˜¯éé€ƒé€¸çš„ï¼Œé™¤éä½ è¿›å…¥å¼‚æ­¥ã€åå°ã€å›è°ƒç­‰åœºæ™¯ã€‚
> - ä½¿ç”¨ `@escaping` çš„å‡½æ•°é€šå¸¸ä¸ä½ çš„çŠ¶æ€æ›´æ–°æœ‰å…³ï¼Œæ‰€ä»¥è¦æ³¨æ„é—­åŒ…æ•è· `@State` æˆ– `@Binding` çš„æ–¹å¼ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚

# 6.static vars and func

åœ¨ Swiftï¼ˆåŒ…æ‹¬ SwiftUIï¼‰ä¸­ï¼Œç”¨ `static` ä¿®é¥°çš„å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯â€œç±»å‹çº§â€ï¼ˆtype-levelï¼‰çš„ï¼Œè€Œä¸æ˜¯â€œå®ä¾‹çº§â€ï¼ˆinstance-levelï¼‰çš„ã€‚å®ƒä»¬çš„ä¸»è¦ç‰¹ç‚¹å’Œå¸¸è§ç”¨æ³•åŒ…æ‹¬ï¼š

------

### 6.1 `static` å±æ€§ï¼ˆé™æ€å˜é‡ï¼å¸¸é‡ï¼‰

- **å®šä¹‰æ–¹å¼**

  ```swift
  struct ContentView: View {
      // å­˜å‚¨å‹é™æ€å¸¸é‡
      static let defaultTitle: String = "æ¬¢è¿"
      
      // è®¡ç®—å‹é™æ€å±æ€§
      static var defaultColor: Color {
          return .blue.opacity(0.8)
      }
      
      var body: some View {
          Text(Self.defaultTitle)
              .foregroundColor(Self.defaultColor)
      }
  }
  ```

- **ç‰¹ç‚¹**

  1. **ä¸å®ä¾‹æ— å…³**ï¼šä¸éœ€è¦åˆ›å»º `ContentView()` å®ä¾‹ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡ `ContentView.defaultTitle` è®¿é—®ã€‚
  2. **å…±äº«**ï¼šåœ¨æ‰€æœ‰å®ä¾‹ä¸­åªæœ‰ä¸€ä»½å­˜å‚¨æˆ–è®¡ç®—é€»è¾‘ï¼Œå¯ç”¨äºç¼“å­˜é‡ç”¨ï¼Œæ¯”å¦‚ `NumberFormatter`ã€`DateFormatter`ã€è‡ªå®šä¹‰æ ·å¼ç­‰ã€‚
  3. **å»¶è¿Ÿåˆå§‹åŒ–**ï¼šå­˜å‚¨å‹ `static` å±æ€§åœ¨é¦–æ¬¡è®¿é—®æ—¶æ‰ä¼šåˆ›å»ºï¼ˆthread-safeï¼‰ã€‚

------

### 6.2 `static` æ–¹æ³•ï¼ˆé™æ€å‡½æ•°ï¼‰

- **å®šä¹‰æ–¹å¼**

  ```swift
  struct ContentView: View {
      static func greeting(for name: String) -> String {
          "Hello, \(name)!"
      }
      
      var body: some View {
          Text(Self.greeting(for: "SwiftUI"))
      }
  }
  ```

- **ç”¨é€”**

  - ç¼–å†™ä¸å®ä¾‹æ— å…³çš„â€œå·¥å…·å‡½æ•°â€æˆ–â€œå·¥å‚æ–¹æ³•â€ã€‚
  - åœ¨ `View` ä¸­ä½œä¸ºè¾…åŠ©é€»è¾‘ï¼Œé¿å…åœ¨ `body` ä¸­å‡ºç°å¤æ‚è®¡ç®—ã€‚

------

### 6.3 ä¸ `class` çš„åŒºåˆ«

- `static` åªèƒ½ç”¨äº**å€¼ç±»å‹**ï¼ˆå¦‚ `struct`ã€`enum`ï¼‰æˆ– `class` çš„â€œä¸å¯é‡å†™â€æˆå‘˜ã€‚
- `class` æ–¹æ³•æˆ–å±æ€§å¯ä»¥åœ¨å­ç±»ä¸­ç”¨ `override` é‡å†™ï¼›è€Œ `static` åˆ™ä¸å…è®¸é‡å†™ã€‚

------

### 6.4 SwiftUI ç‰¹æ®Šç”¨ä¾‹ï¼šé¢„è§ˆæä¾›è€…

```swift
struct ContentView_Previews: PreviewProvider {
    // SwiftUI è¦æ±‚ï¼šå¿…é¡»æ˜¯ static var
    static var previews: some View {
        ContentView()
            .previewLayout(.sizeThatFits)
    }
}
```

- `PreviewProvider` åè®®è¦æ±‚æä¾›ä¸€ä¸ª `static var previews`ï¼Œç”¨æ¥åœ¨ Xcode ç”»å¸ƒä¸­æ¸²æŸ“å¤šç»„é¢„è§ˆã€‚

------

### 6.5 ä½¿ç”¨å»ºè®®

1. **å¸¸é‡ã€å…±äº«èµ„æº**ï¼šå°†ä¸éšå®ä¾‹å˜åŒ–çš„é…ç½®ã€æ ·å¼ã€Formatter ç­‰æ”¾è¿› `static let`ã€‚
2. **è¾…åŠ©å‡½æ•°**ï¼šä¸è§†å›¾å®ä¾‹çŠ¶æ€æ— å…³çš„çº¯å‡½æ•°å¯å£°æ˜ä¸º `static func`ã€‚
3. **å‘½åç©ºé—´**ï¼šå¯åˆ©ç”¨ `struct` + `static` å¯¹ä¸€ç»„ç›¸å…³å¸¸é‡ï¼æ–¹æ³•è¿›è¡Œé€»è¾‘åˆ†ç»„ã€‚

# 7.semantic rename 

åœ¨Xcodeä¸­æˆ‘ä»¬å¦‚æœæƒ³å¯¹ä¸€ä¸ªæ¥å£æˆ–è€…ç±»å‹è¿›è¡Œä¿®æ”¹å‘½åçš„è¯ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥æ‰‹åŠ¨ä¿®æ”¹ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå¹¶ä¸”ä¼šå¯¼è‡´ä¿®æ”¹é”™è¯¯ï¼›

è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å€ŸXcodeæä¾›çš„ä¿®æ”¹æ¥å£æ¥å®Œæˆæˆ‘ä»¬çš„ä¿®æ”¹æ“ä½œï¼š

- Step1ï¼šé€‰æ‹©ä½ è¦ä¿®æ”¹ç±»å‹åå³é”®ä¹‹åé€‰æ‹©refactor->rename

![Lecture4-1](/Users/qingyangmi/learn/iOS/Note/image/Lecture4-1.png)

- Step2: åœ¨è¾“å…¥æ¡†é‡Œå†™å…¥ä¿®æ”¹åçš„åç§°ï¼Œç„¶åç‚¹å‡»rename å°±å¥½äº†ï¼

![Lecture4-2](/Users/qingyangmi/learn/iOS/Note/image/Lecture4-2.png)

# 8.mutating

åœ¨ Swift é‡Œï¼Œ`mutating` æ˜¯ä¸€ä¸ªä¿®é¥°ç¬¦ï¼Œç”¨åœ¨**å€¼ç±»å‹**ï¼ˆ`struct` æˆ– `enum`ï¼‰çš„æ–¹æ³•å‰ï¼Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•ä¼šä¿®æ”¹å®ƒè‡ªèº«ï¼ˆ`self`ï¼‰æˆ–å®ƒçš„å±æ€§ã€‚å› ä¸ºå€¼ç±»å‹é»˜è®¤æ–¹æ³•ä¸èƒ½æ”¹å˜è‡ªå·±ï¼ˆä»¥ä¿è¯å€¼è¯­ä¹‰ï¼‰ï¼ŒåŠ ä¸Š `mutating` åï¼Œç¼–è¯‘å™¨æ‰å…è®¸ä½ åœ¨æ–¹æ³•é‡Œå†™è¯¸å¦‚ `self.count += 1` ä¹‹ç±»çš„æ“ä½œã€‚

------

## 8.1ä¸ºä»€ä¹ˆéœ€è¦ `mutating`

- **å€¼ç±»å‹ä¸å¯å˜æ€§**
   é»˜è®¤æƒ…å†µä¸‹ï¼Œ`struct`/`enum` çš„æ–¹æ³•é‡Œä¸å…è®¸ä¿®æ”¹å®ƒä»¬çš„å­˜å‚¨å±æ€§ï¼š

  ```swift
  struct Point {
      var x: Double, y: Double
  
      func moveBy(dx: Double, dy: Double) {
          // x += dx   // âŒ ç¼–è¯‘é”™è¯¯ï¼šCannot assign to property: 'self' is immutable
      }
  }
  ```

- **åŠ ä¸Š `mutating` åå°±è¡Œäº†**

  ```swift
  struct Point {
      var x: Double, y: Double
  
      mutating func moveBy(dx: Double, dy: Double) {
          x += dx    // âœ…
          y += dy
      }
  }
  ```

------

## 8.2 åœ¨ SwiftUI ä¸­çš„å…¸å‹ç”¨æ³•

è™½ç„¶ SwiftUI çš„ `View` æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ª `struct`ï¼Œä½†ä½ å‡ ä¹ä¸ä¼šåœ¨è‡ªå®šä¹‰çš„ `View` ä¸Šç›´æ¥å†™ `mutating func`ï¼›è€Œæ˜¯é€šè¿‡**å±æ€§åŒ…è£…å™¨**ï¼ˆå¦‚ `@State`ã€`@Binding`ï¼‰æ¥ç®¡ç†å¯å˜çŠ¶æ€ã€‚æ¯”å¦‚ï¼š

```swift
struct CounterView: View {
    // è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„â€œç›’å­â€ï¼Œåº•å±‚å¸®ä½ åšäº† mutating
    @State private var count = 0

    var body: some View {
        VStack {
            Text("Count: \(count)")
            Button("Increment") {
                count += 1   // ä¸ç”¨è‡ªå·±å†™ mutating
            }
        }
    }
}
```

å¦‚æœä½ è¦åœ¨ **ç‹¬ç«‹çš„æ¨¡å‹ç±»å‹**ï¼ˆé Viewï¼‰é‡Œå°è£…ä¿®æ”¹é€»è¾‘ï¼Œå°±è¦ç”¨ `mutating`ï¼š

```swift
// åªæ˜¯ä¸€ä¸ªçº¯å€¼ç±»å‹æ¨¡å‹ï¼Œå®ƒä¼šè¢« @State æˆ– @ObservedObject æŒæœ‰
struct Counter {
    var value = 0

    mutating func increment() {
        value += 1
    }
}

struct CounterView: View {
    @State private var counter = Counter()

    var body: some View {
        VStack {
            Text("Value: \(counter.value)")
            Button("ï¼‹") {
                counter.increment()  // è°ƒç”¨çš„æ˜¯ mutating æ–¹æ³•
            }
        }
    }
}
```

------

## 8.3 ä½•æ—¶åœ¨ SwiftUI é‡ŒçœŸæ­£ç”¨åˆ° `mutating`

1. **è‡ªå®šä¹‰ä¸šåŠ¡æ¨¡å‹**ï¼ˆçº¯ Swift ç»“æ„ä½“ï¼‰
   - å°†å¯å˜é€»è¾‘å°è£…åœ¨æ¨¡å‹å†…éƒ¨ï¼Œç”¨ `mutating` æ ‡è®°ã€‚
   - é€šè¿‡ `@State`ã€`@Binding` æˆ– `@ObservedObject` åœ¨ View ä¸­å¼•ç”¨æ¨¡å‹å®ä¾‹ã€‚
2. **æ‰©å±•å€¼ç±»å‹**
   - ä¾‹å¦‚ç»™è‡ªå®šä¹‰ `Shape`ã€`Layout`ã€`PreferenceKey` ç­‰ç»“æ„ä½“æ·»åŠ ä¿®æ”¹è‡ªèº«çŠ¶æ€çš„æ–¹æ³•ã€‚
3. **åè®®å®ç°é‡Œéœ€è¦ä¿®æ”¹è‡ªèº«**
   - æŸäº›åè®®ï¼ˆå¦‚è‡ªå®šä¹‰çš„åè®®ï¼‰è¦æ±‚æ–¹æ³•èƒ½æ”¹å˜ç»“æ„ä½“å±æ€§ï¼Œå°±è¦åœ¨æ–¹æ³•ç­¾åå‰åŠ  `mutating`ã€‚

------

## 8.4 å°ç»“

- **Swift è¯­è¨€å±‚é¢**ï¼š`mutating` è®©å€¼ç±»å‹æ–¹æ³•èƒ½å¤Ÿæ”¹å˜ `self`ã€‚
- **SwiftUI å±‚é¢**ï¼šå¤§å¤šæ•°çŠ¶æ€å˜åŒ–éƒ½æ˜¯é€šè¿‡å±æ€§åŒ…è£…å™¨æ¥å®ç°ï¼Œä½ å¾ˆå°‘åœ¨ `View` ä¸Šç›´æ¥å†™ `mutating`ã€‚
- **æœ€ä½³å®è·µ**ï¼šå¦‚æœæ¨¡å‹æœ¬èº«æ˜¯å€¼ç±»å‹ï¼Œè€Œä¸”ä½ æƒ³æŠŠä¿®æ”¹é€»è¾‘å°è£…è¿›å»ï¼Œåˆ«å¿˜äº†åœ¨æ–¹æ³•å‰åŠ  `mutating`ï¼›åœ¨ View é‡Œå°±ç›´æ¥è°ƒç”¨æ¨¡å‹æ–¹æ³•æˆ–æ“ä½œ `@State`ï¼`@Binding` å³å¯ã€‚

# 9.Swiftä¸­çš„çŠ¶æ€ç®¡ç†

## 9.1 æ ¸å¿ƒç†å¿µ

- **å£°æ˜å¼ï¼‹å“åº”å¼**ï¼šUI å£°æ˜â€œæˆ‘æƒ³å±•ç¤ºä»€ä¹ˆâ€ï¼ŒçŠ¶æ€æ”¹å˜åè‡ªåŠ¨â€œé‡ç»˜â€ç•Œé¢ã€‚
- **å•ä¸€çœŸç›¸**ï¼ˆSingle Source of Truthï¼‰ï¼šçŠ¶æ€ï¼ˆStateï¼‰æ˜¯å”¯ä¸€å¯é çš„æ•°æ®æºï¼Œæ‰€æœ‰ UI éƒ½ä»å®ƒæ´¾ç”Ÿã€‚
- **å“åº”å¼æ›´æ–°æµç¨‹**ï¼š
  1. **çŠ¶æ€æ”¹å˜**ï¼ˆ@Stateã€@Publishedâ€¦ï¼‰
  2. **Publisher å‘äº‹ä»¶**
  3. **SwiftUI æ ‡è®°å¤±æ•ˆ**
  4. **é‡æ–°æ‰§è¡Œ `body`**
  5. **diff & æ¸²æŸ“**ï¼ˆåªæ˜¯æ›´æ–°å¿…è¦éƒ¨åˆ†ï¼‰

------

## 9.2 å±æ€§åŒ…è£…å™¨è¯¦è§£

ä¸‹é¢ä»¥**å®šä¹‰ â†’ å…·ä½“ä»£ç ç¤ºä¾‹ â†’ æ•°æ®æµé€š â†’ åº”ç”¨åœºæ™¯**å››æ­¥æ¥å±•å¼€è®²è§£ã€‚

------

### 1. @State

- **å®šä¹‰**ï¼šåœ¨å•ä¸ª View å†…éƒ¨ç®¡ç†ç§æœ‰ã€å¯å˜çš„å€¼ç±»å‹çŠ¶æ€ã€‚

- **ç¤ºä¾‹**ï¼š

  ```swift
  struct CounterView: View {
      @State private var count: Int = 0
  
      var body: some View {
          VStack {
              Text("Count: \(count)")
              Button("ï¼‹1") { count += 1 }
          }
          .padding()
      }
  }
  ```

- **æ•°æ®æµé€š**ï¼š

  1. `count += 1` â†’ å†™å…¥å†…éƒ¨â€œçŠ¶æ€æ§½â€
  2. `@State` åº•å±‚æ˜¯ Combine Publisherï¼Œå‘å‡ºæ–°å€¼äº‹ä»¶
  3. SwiftUI æ ‡è®°è¯¥ View å¤±æ•ˆ â†’ ä¸‹ä¸€å¸§è°ƒç”¨ `body`
  4. diff æ–°æ—§è§†å›¾ â†’ æœ€å°åŒ–æ›´æ–°

- **åº”ç”¨åœºæ™¯**ï¼š

  - **å±€éƒ¨ã€è½»é‡**ï¼šå¼€å…³ã€è®¡æ•°å™¨ã€TextField æ–‡æœ¬å†…å®¹ç­‰ï¼Œä»…é™å½“å‰ View ä½¿ç”¨çš„çŠ¶æ€ã€‚

------

### 2. @Binding

- **å®šä¹‰**ï¼šåœ¨çˆ¶â€“å­ View é—´å»ºç«‹åŒå‘å¼•ç”¨ï¼Œå­ View å¯ä»¥è¯»å†™çˆ¶ View çš„ `@State`ã€‚

- **ç¤ºä¾‹**ï¼š

  ```swift
  // çˆ¶ View
  struct ParentView: View {
      @State private var isOn = false
  
      var body: some View {
          ToggleView(isOn: $isOn)
      }
  }
  
  // å­ View
  struct ToggleView: View {
      @Binding var isOn: Bool
  
      var body: some View {
          Toggle("å¼€å…³", isOn: $isOn)
              .padding()
      }
  }
  ```

- **æ•°æ®æµé€š**ï¼š

  1. å­ View è°ƒç”¨ `isOn.toggle()`
  2. å®é™…ä¿®æ”¹çˆ¶ View çš„ `@State isOn` â†’ è§¦å‘ `@State` æµç¨‹
  3. çˆ¶ View é‡ç®— `body`ï¼Œé€šè¿‡ `$isOn` ä¼ å›æœ€æ–°å€¼ç»™å­ View

- **åº”ç”¨åœºæ™¯**ï¼š

  - **ç»„ä»¶åŒ–**ï¼šå½“ä½ æ‹†åˆ† Viewï¼Œå¸Œæœ›å­ç»„ä»¶æ—¢èƒ½è¯»å–åˆèƒ½ä¿®æ”¹çˆ¶ç»„ä»¶çš„çŠ¶æ€æ—¶ã€‚

------

### 3. @StateObject

- **å®šä¹‰**ï¼šç”¨äºåœ¨ View **é¦–æ¬¡**åˆ›å»ºæ—¶åˆå§‹åŒ–å¹¶æŒæœ‰ä¸€ä¸ª `ObservableObject`ï¼Œè´Ÿè´£å…¶ç”Ÿå‘½å‘¨æœŸã€‚

- **ç¤ºä¾‹**ï¼š

  ```swift
  final class TimerModel: ObservableObject {
      @Published var seconds = 0
      private var timer: Timer?
  
      init() {
          timer = Timer.scheduledTimer(withTimeInterval: 1, repeats: true) { _ in
              self.seconds += 1
          }
      }
  }
  
  struct TimerView: View {
      @StateObject private var model = TimerModel()
  
      var body: some View {
          Text("Time: \(model.seconds)s")
              .font(.largeTitle)
      }
  }
  ```

- **æ•°æ®æµé€š**ï¼š

  1. `model.seconds += 1` â†’ `@Published` å‘äº‹ä»¶
  2. SwiftUI æ•è·äº‹ä»¶ â†’ æ ‡è®° `TimerView` å¤±æ•ˆ
  3. é‡ç®— `body` â†’ æ›´æ–°æ˜¾ç¤º

- **åº”ç”¨åœºæ™¯**ï¼š

  - **View è‡ªæœ‰çš„å¤æ‚çŠ¶æ€**ï¼Œå¦‚ç½‘ç»œè¯·æ±‚ç»“æœã€å®šæ—¶å™¨ã€éŸ³è§†é¢‘æ’­æ”¾å™¨ç­‰åªç”±è¯¥ View ç®¡ç†çš„å¯¹è±¡ã€‚

------

### 4. @ObservedObject

- **å®šä¹‰**ï¼šç”¨äºè®¢é˜…å¤–éƒ¨ä¼ å…¥çš„ `ObservableObject`ï¼Œç›‘å¬å…¶ `@Published` å±æ€§ã€‚

- **ç¤ºä¾‹**ï¼š

  ```swift
  final class Settings: ObservableObject {
      @Published var username: String = ""
  }
  
  struct ProfileView: View {
      @ObservedObject var settings: Settings
  
      var body: some View {
          VStack {
              TextField("ç”¨æˆ·å", text: $settings.username)
                  .textFieldStyle(RoundedBorderTextFieldStyle())
              Text("Hello, \(settings.username)")
          }
          .padding()
      }
  }
  
  // ä½¿ç”¨æ—¶ç”±çˆ¶ View æˆ–ç¯å¢ƒä¼ å…¥
  struct Container: View {
      @StateObject private var settings = Settings()
      var body: some View { ProfileView(settings: settings) }
  }
  ```

- **æ•°æ®æµé€š**ï¼š

  1. å¤–éƒ¨æŸå¤„ `settings.username = "æ–°å"` â†’ `@Published` å‘äº‹ä»¶
  2. SwiftUI æ ‡è®° `ProfileView` å¤±æ•ˆ â†’ é‡ç®— `body` â†’ æ›´æ–°ç•Œé¢

- **åº”ç”¨åœºæ™¯**ï¼š

  - **å…±äº«çŠ¶æ€**ï¼šå¤šä¸ªå­ View éœ€è¦è®¢é˜…åŒä¸€ä¸ªæ¨¡å‹ï¼Œä½†æ¨¡å‹çš„ç”Ÿå‘½å‘¨æœŸç”±å¤–éƒ¨ç®¡ç†æ—¶ã€‚

------

### 5. @EnvironmentObject

- **å®šä¹‰**ï¼šåœ¨ç¯å¢ƒä¸­å…¨å±€æ³¨å…¥å¹¶å…±äº«çš„ `ObservableObject`ï¼Œå¯è·¨å¤šå±‚ View è®¿é—®ã€‚

- **ç¤ºä¾‹**ï¼š

  ```swift
  @main
  struct MyApp: App {
      @StateObject private var userData = UserData()
  
      var body: some Scene {
          WindowGroup {
              ContentView()
                  .environmentObject(userData)
          }
      }
  }
  
  struct ContentView: View {
      var body: some View {
          VStack {
              ProfileView()      // åŠå…¶å­ View å‡èƒ½è®¿é—® userData
              DashboardView()
          }
      }
  }
  
  struct ProfileView: View {
      @EnvironmentObject var userData: UserData
      var body: some View { Text("User: \(userData.name)") }
  }
  ```

- **æ•°æ®æµé€š**ï¼š

  1. ä»»æ„å±‚çº§è°ƒç”¨ `userData.name = "æ–°å"` â†’ `@Published` å‘äº‹ä»¶
  2. æ‰€æœ‰è®¢é˜…è¯¥å¯¹è±¡çš„ View éƒ½å¤±æ•ˆ â†’ å„è‡ªé‡ç®— `body` â†’ æ›´æ–°

- **åº”ç”¨åœºæ™¯**ï¼š

  - **è·¨æ¨¡å—å…±äº«**ï¼šç”¨æˆ·è®¾ç½®ã€å…¨å±€ä¸»é¢˜ã€è´­ç‰©è½¦æ•°æ®ç­‰éœ€è¦åœ¨ App å¤šå¤„è®¿é—®çš„å…¨å±€çŠ¶æ€ã€‚

------

### 6. @Environment

- **å®šä¹‰**ï¼šè¯»å–ç³»ç»Ÿæˆ–è‡ªå®šä¹‰çš„ç¯å¢ƒå€¼ï¼ˆå¦‚é…è‰²æ–¹æ¡ˆã€å­—ä½“ã€å¸ƒå±€æ–¹å‘ç­‰ï¼‰ã€‚

- **ç¤ºä¾‹**ï¼š

  ```swift
  struct ThemedView: View {
      @Environment(\.colorScheme) var colorScheme
      var body: some View {
          Text("å½“å‰æ¨¡å¼ï¼š\(colorScheme == .dark ? "æ·±è‰²" : "æµ…è‰²")")
              .padding()
      }
  }
  ```

- **æ•°æ®æµé€š**ï¼š

  1. ç³»ç»Ÿæˆ–çˆ¶ View ä¿®æ”¹ç¯å¢ƒå€¼ï¼ˆå¦‚ Light â†” Darkï¼‰
  2. å¯¹åº” `@Environment` è‡ªåŠ¨å‘äº‹ä»¶
  3. ä¾èµ–è¯¥ç¯å¢ƒå€¼çš„ View å¤±æ•ˆ â†’ é‡ç®— `body` â†’ æ›´æ–°

- **åº”ç”¨åœºæ™¯**ï¼š

  - **å“åº”ç³»ç»Ÿå˜åŒ–**ï¼šè‡ªåŠ¨é€‚é…æ·±æµ…è‰²æ¨¡å¼ã€åŠ¨æ€å­—ä½“å¤§å°ã€æœ¬åœ°åŒ–åŒºåŸŸç­‰ã€‚

------

## 9.3 å®Œæ•´æ•°æ®æµåŠ¨æµç¨‹

1. **ä¿®æ”¹çŠ¶æ€**ï¼ˆ`@State`ã€`@Published`ã€ç¯å¢ƒå€¼â€¦ï¼‰
2. **Publisher å‘äº‹ä»¶**ï¼ˆCombineï¼‰
3. **SwiftUI æ ‡è®°å¤±æ•ˆ**ï¼ˆinvalidateï¼‰
4. **é‡æ–°æ‰§è¡Œ `body`**ï¼ˆbody engineï¼‰
5. **Diff & æ¸²æŸ“**ï¼ˆæœ€å°åŒ– UI æ›´æ–°ï¼‰

------

## 9.4 é€‰ç”¨æŒ‡å—ä¸å®è·µ

| åœºæ™¯                                                    | å±æ€§åŒ…è£…å™¨           |
| ------------------------------------------------------- | -------------------- |
| **ä»…åœ¨å½“å‰ View å†…ç®€å•å˜åŒ–**                            | `@State`             |
| **çˆ¶â€“å­ç»„ä»¶éœ€åŒå‘è¯»å†™åŒä¸€çŠ¶æ€**                         | `@Binding`           |
| **View é¦–æ¬¡åˆ›å»ºå¹¶æ‹¥æœ‰éœ€åœ¨ View ç”Ÿå‘½å‘¨æœŸå†…æŒæœ‰å¤æ‚å¯¹è±¡** | `@ObservableObject`  |
| **å¤–éƒ¨åˆ›å»ºã€ç”±å¤šä¸ª View è®¢é˜…çš„ ObservableObject**       | `@ObservedObject`    |
| **è·¨å¤šå±‚çº§ã€å…¨å±€å…±äº«çš„ ObservableObject**               | `@EnvironmentObject` |
| **è¯»å–ç³»ç»Ÿæˆ–è‡ªå®šä¹‰ç¯å¢ƒé…ç½®**                            | `@Environment`       |

> **æœ€ä½³å®è·µ**ï¼š
>
> 1. æ˜ç¡®â€œçŠ¶æ€æ‹¥æœ‰è€…â€ï¼ˆOwnerï¼‰ä¸â€œçŠ¶æ€è®¢é˜…è€…â€ï¼ˆSubscriberï¼‰ã€‚
> 2. ä¿æŒçŠ¶æ€æœ€å°åŒ–â€”â€”ä¸å¿…è¦ä¸è¦æå‡åˆ°å…¨å±€ï¼Œå‡å°‘ä¸å¿…è¦çš„åˆ·æ–°ã€‚
> 3. å–„ç”¨å±æ€§åŒ…è£…å™¨ç»„åˆï¼ˆå¦‚ `@State` + `@Binding`ï¼‰ï¼Œæé«˜ç»„ä»¶å¤ç”¨æ€§å’Œå¯æµ‹è¯•æ€§ã€‚
